_id: ceph-cluster
name: Kubernetes & Ceph
description: A [Kubernetes](https://kubernetes.io) and [Ceph](https://ceph.io) cluster providing fault and maintenance tolerant infrastructure
images: 
- path: ceph.png
  alt: Ceph Clustered Storage
- path: k8s.png
  alt: Kubernetes
- path: ubuntu_black-orange_hex_su.png
  alt: Ubuntu Linux
sections:
  - header: Goals
    content: |
      * Survive the outage of up to 2 nodes in any tier with all data intact
      * Recover from catastrphic failures (e.g., total power outages)
      * Minimal power consumption to save energy
      * Plenty of storage for media collections, records, backups, etc.
      * Plenty of compute power for local applications
      * Low maintenance, self-healing
  - header: Hardware
    content: |
      * 2x [HPe MicroServer Gen10 Plus](https://buy.hpe.com/us/en/servers/proliant-microserver/proliant-microserver/proliant-microserver/hpe-proliant-microserver-gen10-plus/p/1012241014)
        * 32GB RAM
        * System Disk: 240GB Corsair Force MP510 NVMe
        * Ceph Data Disks: 4x Seagate BarraCuda 8TB
      * 7x [Raspberry Pi 4, 8GB](https://www.raspberrypi.org/products/raspberry-pi-4-model-b/) Worker Node
        * System Disk: 32GB MicroSD
        * Data Disk: 120GB SSD (logs, container images)
      * 8x [Raspberry Pi 4, 8GB](https://www.raspberrypi.org/products/raspberry-pi-4-model-b/) OSD Node
        * System Disk: 32GB MicroSD
        * Data Disk: 1TB USB SSD
      * 1x [UCTRONICS 1U Rackmount for up to 4x Raspberry Pi 4](https://www.uctronics.com/cluster-and-rack-mount/uctronics-ultimate-rackmount-for-raspberry-pi-4-19-1u-rack-mount-supports-1-4-units.html)
      * 1x old custom 2U server
        * RAM: 8GB
        * System Disk: 128GB NVMe
        * Data Disks: 4x 3TB disks, various makes/models
      * 2x [3U Raspberry Pi enclosure](https://www.myelectronics.nl/us/19-inch-rack-mount-3u-for-12-16x-raspberry-pi.html)
  - header: Kubernetes Configuration
    content: |
      * kubernetes 1.24
      * cri-o 1.20
      * calico 3.18
  - header: Ceph Configuration
    content: |
      * 3x mon
      * 1x mgr
      * 2x active mds w/ 2x cold standby
      * 22x osd (12 HDD, 8 SSD, 2 NVMe for cache and temp storage)
      * managed by [rook](https://rook.io)
      * dedicated storage pools for different workloads (lower redundancy for media, higher redundancy for documents)
  - header: Consumers
    content: |
      * [Emby](https://emby.media/) media server
      * [Plex](https://plex.tv) media server
      * [Samba](https://www.samba.org/) file server
      * [UniFi Controller](https://www.ui.com/) for network device management 
      * [MongoDB](https://www.mongodb.com/) for the UniFi controller, plus a few smaller services
      * [openHAB](https://www.openhab.org/) for [home automation](./home-automation.html)
      * [motionEye](https://github.com/motioneye-project/motioneye) for camera management
      * [chrony](https://chrony.tuxfamily.org/) NTP server
      * [mosquitto](https://mosquitto.org/) lightweight MQTT broker
      * [Storj](https://storj.io) data node